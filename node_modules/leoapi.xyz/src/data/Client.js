const fetch = require('node-fetch');
const {  createCanvas, loadImage } = require('canvas');

module.exports = class Client {
    constructor() {}
    
    async image(endpoint, params = {}) {
        if(!endpoint) throw new Error('[leoapi] | Please provide an image endpoint.')

        const qParams = new URLSearchParams(params)

        const res = `https://api.leoapi.xyz/image/${endpoint}?${qParams}`;

        const base = await loadImage(res);
        const canvas = createCanvas(base.width, base.height)
        const ctx = canvas.getContext("2d")

        ctx.drawImage(base, 0, 0)

        return canvas.toBuffer()
    }

    async data(endpoint, params = {}) {
        if(!endpoint) throw new Error('[leoapi] | Please provide a data endpoint.')

        const qParams = new URLSearchParams(params)

        const res = await fetch(`https://api.leoapi.xyz/data/${endpoint}?${qParams}`)

        const json = await res.json();
        if(json.error) throw new Error(json.error)
        return json

        return res

    }

    async text(endpoint, params = {}) {
        if(!endpoint) throw new Error('[leoapi] | Please provide a text endpoint.')

        const qParams = new URLSearchParams(params)

        const res = await fetch(`https://api.leoapi.xyz/text/${endpoint}?${qParams}`)

        const json = await res.json();
        if(json.error) throw new Error(json.error)
        return json

    }

    async fun(endpoint, params = {}) {
        if(!endpoint) throw new Error('[leoapi] | Please provide a fun endpoint.')

        const qParams = new URLSearchParams(params)

        const res = await fetch(`https://api.leoapi.xyz/fun/${endpoint}?${qParams}`)

        const json = await res.json();
        if(json.error) throw new Error(json.error)
        return json

    }

    async code({ title, description, code, token}) {
    if(!token) throw new Error('[leoapi] | Please provide a token, to get one go to https://leoapi.xyz/discord');
    if(!code) throw new Error("[leoapi] | Please provide a code to create a bin with");

    const res = await fetch(`https://code.leoapi.xyz/api/create?code=${code}&title=${title ? title : 'code.leoapi.xyz'}&description=${description ? description : "Share your code with ease"}`, {
        method: "POST",
        headers: {'Content-Type': 'application/json','Authorization': `Bearer ${token}`}
      })
      const json = await res.json()
      if(json.error) throw new Error(json.error)
      return json.url;
}

}